<!DOCTYPE html>
<html>
<head>
    <title>é˜¿æ°è¿·å®«</title>
    <style>
        body {
            font-family: "Consolas", "å¾®è½¯é›…é»‘", monospace;
            background: #000;
            color: #fff;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }
        .maze-container {
            margin: 20px 0;
        }
        .cell {
            display: inline-block;
            width: 25px;
            height: 25px;
            text-align: center;
            line-height: 25px;
        }
        .wall { color: #8B4513; } /* å¢™ï¼šæ£•è‰² */
        .path { color: #fff; } /* è·¯å¾„ï¼šç™½è‰² */
        .player { color: #4CAF50; } /* ç©å®¶ï¼šç»¿è‰² */
        .clown { color: #FF0000; } /* å°ä¸‘ï¼šçº¢è‰² */
        .exit { color: #9C27B0; } /* å‡ºå£ï¼šç´«è‰² */
        .guide { color: #2196F3; } /* æŒ‡å¼•è·¯çº¿ï¼šè“è‰² */
        .border-text { color: #FF0000; } /* æ ‡é¢˜è¾¹æ¡†ï¼šçº¢è‰² */
        .info-text { margin: 10px 0; }
        .win-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: #000;
            padding: 20px;
            border: 2px solid #FF0000;
        }
        .girl { color: #FFC107; } /* ç¾å¥³ï¼šé»„è‰² */
    </style>
</head>
<body>
    <div id="info" class="info-text"></div>
    <div id="maze" class="maze-container"></div>
    <div id="controls" class="info-text">W=ä¸Š S=ä¸‹ A=å·¦ D=å³ | æŒ‰Mæ˜¾ç¤ºè·¯çº¿ | Q=é€€å‡º</div>
    <div id="winScreen" class="win-screen" style="display: none;"></div>

    <script>
        // å…¨å±€å˜é‡
        let maze = [];
        let correctPath = [];
        let visited = [];
        let W, H;
        let playerX, playerY;
        let exitX, exitY;
        let gameOver = false;
        let isGameCleared = false;
        let showCorrectPath = false;
        const WALL = "â– ";
        const PATH = " ";
        const EXIT_CHAR = "x";
        const BORDER_TEXT = "é˜¿æ°è¿·å®«";
        const FINAL_TEXT = "ä½ èµ°å‡ºäº†è¿·å®«ï¼Œå´æ²¡èµ°è¿›å¥¹çš„å†…å¿ƒ";
        const GIRL_EMOJI = "ğŸ‘©ğŸ»";
        const GIRL_SPEECH = "å“ˆå“ˆå“ˆå“ˆå“ˆçœŸæ˜¯å°ä¸‘";
        const playerChar = "o";
        const clownChar = "ğŸ¤¡";

        // æ—¶é—´æ¨¡å¼
        let isInfiniteTime = false;
        let remainingTime = 0;
        let startTime;
        let lastRefreshTime;

        // ç”Ÿæˆè¿·å®«ï¼ˆDFSç®—æ³•ï¼‰
        function generateMazeDFS(x, y) {
            maze[y][x] = PATH;
            const dirs = [[0,2], [0,-2], [2,0], [-2,0]];
            // éšæœºæ‰“ä¹±æ–¹å‘
            for (let i = 0; i < dirs.length; i++) {
                const j = Math.floor(Math.random() * dirs.length);
                [dirs[i], dirs[j]] = [dirs[j], dirs[i]];
            }

            for (const dir of dirs) {
                const nx = x + dir[0];
                const ny = y + dir[1];
                if (nx >=1 && nx < W-1 && ny >=1 && ny < H-1 && maze[ny][nx] === WALL) {
                    maze[ny - dir[1]/2][nx - dir[0]/2] = PATH;
                    generateMazeDFS(nx, ny);
                }
            }
        }

        // å¯»æ‰¾æ­£ç¡®è·¯å¾„ï¼ˆDFSï¼‰
        function dfsGuidePath(x, y) {
            if (x === exitX && y === exitY) {
                correctPath[y][x] = true;
                return true;
            }
            if (x < 1 || x >= W-1 || y < 1 || y >= H-1 || maze[y][x] === WALL || visited[y][x]) {
                return false;
            }
            
            visited[y][x] = true;
            if (dfsGuidePath(x+1, y) || dfsGuidePath(x-1, y) || dfsGuidePath(x, y+1) || dfsGuidePath(x, y-1)) {
                correctPath[y][x] = true;
                return true;
            }
            return false;
        }

        // ç”Ÿæˆè¿·å®«ï¼ˆå«è¾¹ç•Œæ ‡é¢˜ï¼‰
        function generateMaze(mode) {
            W = mode === 1 ? 17 : 23;
            H = mode === 1 ? 11 : 15;
            maze = Array(H).fill().map(() => Array(W).fill(WALL));
            correctPath = Array(H).fill().map(() => Array(W).fill(false));
            visited = Array(H).fill().map(() => Array(W).fill(false));

            // è¾¹ç•Œè®¾ä¸ºå¢™
            for (let x = 0; x < W; x++) {
                maze[0][x] = WALL;
                maze[H-1][x] = WALL;
            }
            for (let y = 0; y < H; y++) {
                maze[y][0] = WALL;
                maze[y][W-1] = WALL;
            }

            generateMazeDFS(1, 1);

            // ç©å®¶èµ·ç‚¹
            playerX = 1;
            playerY = 1;
            // æ ‡é¢˜ï¼ˆé˜¿æ°è¿·å®«ï¼‰
            const titleChars = BORDER_TEXT.split('');
for(è®©i=0ï¼›i<titleChars.length&&i<Wï¼›i++){
maze[0][i+1]=titleChars[i]ï¼›
            }
// å‡ºå£
exitX=W-2ï¼›
exitY=H-2ï¼›
maze[exitY][exitX]=EXIT_CHARï¼›

dfsGuidePath(playerXï¼Œplayerery)ï¼›
        }

// é€‰æ‹©éš¾åº¦
å¼‚æ­¥å‡½æ•°chooseDiffistory(){
Const diff=ç­‰å¾…æç¤º("=========é˜¿æ°è¿·å®«=========\n1=ç®€å•æ¨¡å¼(å°è¿·å®«)2=å›°éš¾æ¨¡å¼(å¤§è¿·å®«)\nè¾“å…¥æ•°å­—é€‰æ‹©ï¼š"ï¼Œ"1")ï¼›
generateMaze(parseInt(diff))ï¼›
        }

// é€‰æ‹©æ—¶é—´æ¨¡å¼
å¼‚æ­¥å‡½æ•°chooseTimeMode(){
Const choice=await prompt("=========é€‰æ‹©æ—¶é—´æ¨¡å¼=========\n1=æ— é™æ—¶é—´2=é™åˆ¶æ—¶é—´(è¾“å…¥ç§’æ•°)\nè¾“å…¥æ•°å­—é€‰æ‹©ï¼š"ï¼Œ"1")ï¼›
if(choice==="1"){
isInfiniteTime=trueï¼›
}else{
isInfiniteTime=falseï¼›
remainingTime=parseInt(æç¤ºç¬¦("è¯·è¾“å…¥é™åˆ¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼š"ï¼Œ"60"))ï¼›
starttime=Date.now()ï¼›
            }
lastRefreshTime=Date.now()ï¼›
        }

// ç»˜åˆ¶è¿·å®«
å‡½æ•°renderMaze(){
Const mazeDiv=document.getElementById("maze")ï¼›
mazeDiv.innerHTML=""ï¼›
for(è®¾y=0ï¼›y<Hï¼›y++){
Const rowDiv=document.createElement("div")ï¼›
for(è®¾x=0ï¼›x<Wï¼›x++){
Const cellDiv=document.createElement("div")ï¼›
cellDiv.className="cell"ï¼›
                    
if(x===playerX&&y===playery){
cellDiv.className+=isGameClearedï¼Ÿ"å°ä¸‘"ï¼š"ç©å®¶"ï¼›
cellDiv.TextContent=isGameClearedï¼ŸcallowChar:playerCharï¼›
}å¦åˆ™if(x===exitX&&y===exitY){
cellDiv.className+="exit"ï¼›
cellDiv.textContent=EXIT_CHARï¼›
}else if(showCorrectPath&&correctpath[y][x]){
cellDiv.className+="æŒ‡å—"ï¼›
cellDiv.textContent="â†’"ï¼›
}else if(maze[y][x]===å¢™){
cellDiv.className+="å¢™"ï¼›
cellDiv.textContent=WALLï¼›
}else if(maze[y][x]===PATH){
cellDiv.className+="è·¯å¾„"ï¼›
cellDiv.textContent=PATHï¼›
}else{
cellDiv.className+="border-text"ï¼›
cellDiv.textContent=è¿·å®«[y][x]ï¼›
                    }
rowDiv.appendChild(cellDiv)ï¼›
                }
mazeDiv.appendChild(rowDiv)ï¼›
            }

// æ˜¾ç¤ºä¿¡æ¯
Const infoDiv=document.getElementById("info")ï¼›
if(isInfiniteTime){
infoDiv.textContent='å½“å‰ä½ç½®ï¼š(${playerX}ï¼Œ${playererry})|å‡ºå£ï¼š(${exitX}ï¼Œ${exitY})|æ—¶é—´ï¼šæ— é™â€˜ï¼›
}else{
å¸¸æ•°å·²ç”¨æ—¶é—´=math.floor((Date.now()-StartTime)/1000)ï¼›
å‰©ä½™æ—¶é—´=math.max(0ï¼Œå‰©ä½™æ—¶é—´-å·²ç”¨)ï¼›
infoDiv.textContent='å½“å‰ä½ç½®ï¼š(${playerX}ï¼Œ${playererry})|å‡ºå£ï¼š(${exitX}ï¼Œ${exitY})|å‰©ä½™æ—¶é—´ï¼š${remainingTime}ç§’â€˜ï¼›
if(å‰©ä½™æ—¶é—´<=0&&ï¼GameOver){
GameOver=trueï¼›
è­¦æƒ•çš„("æ—¶é—´åˆ°ï¼ ä½ å¤±è´¥äº†")ï¼›
                }
            }
}

// ç§»åŠ¨ç©å®¶
å‡½æ•°MovePlayer(dxï¼Œdy){
if(gameOver||isGameCleared)è¿”å›ï¼›
Const newX=playerX+dxï¼›
Const newY=playery+dyï¼›
if(newX>=0&&newX<W&&newY>=0&&newY<H&&maze[newY][newX]ï¼==å¢™){
playerX=newXï¼›
playery=newYï¼›
renderMaze()ï¼›
// æ£€æŸ¥æ˜¯å¦åˆ°è¾¾å‡ºå£
if(playerX===exitX&&playery===exitY){
isGameCleared=trueï¼›
GameOver=trueï¼›
renderMaze()ï¼›
// æ˜¾ç¤ºé€šå…³ç•Œé¢
Const winscreen=document.getElement ById("winscreen")ï¼›
winScreen.innerHTML='
<h2>${FINAL_TEXT}</h2>
<div class="girl">${GIRL_EMOJI}ï¼š${GIRL_SPEECH}</div>
<p>ä½ ç°åœ¨æ˜¯ï¼š${jownballChar}</p>
`;
winScreen.style.display="block"ï¼›
}
            }
        }

// é”®ç›˜æ§åˆ¶
document.addEventListener('keydown'ï¼Œ(e)=>{
å¼€å…³(e.key.toLowerCase()){
æ¡ˆä¾‹'W'ï¼šMovePlayer(0ï¼Œ-1)ï¼›ä¸­æ–­ï¼›
case's'ï¼šMovePlayer(0ï¼Œ1)ï¼›breakï¼›
æ¡ˆä¾‹'a'ï¼šMovePlayer(-1ï¼Œ0)ï¼›ä¸­æ–­ï¼›
æ¡ˆä¾‹'d'ï¼šMovePlayer(1ï¼Œ0)ï¼›breakï¼›
å¤§å°å†™'M'ï¼šshowCorrectPath=ï¼showCorrectPathï¼›renderMaze()ï¼›æ‰“æ–­ï¼›
æ¡ˆä¾‹'Q'ï¼šå¦‚æœ(ç¡®è®¤("ç¡®å®šé€€å‡ºæ¸¸æˆï¼Ÿ"))window.close()ï¼›breakï¼›
}
});

// åˆå§‹åŒ–æ¸¸æˆ
å¼‚æ­¥å‡½æ•°initGame(){
ç­‰å¾…é€‰æ‹©éš¾åº¦()ï¼›
ç­‰å¾…chooseTimeMode()ï¼›
renderMaze()ï¼›
}

initGame()ï¼›
</script>
</body>
</html>
